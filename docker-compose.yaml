# Codebase Intelligence Infrastructure
# Shared Memgraph instance for:
# - code-graph-rag (structural code analysis)
# - vector-search-mcp (semantic code search)
# - docwell (document search)

services:
  memgraph:
    image: memgraph/memgraph-mage
    container_name: codebase-intelligence-memgraph
    ports:
      - "${MEMGRAPH_PORT:-7687}:7687"       # Bolt protocol
      - "${MEMGRAPH_HTTP_PORT:-7444}:7444"  # HTTP API
    volumes:
      - memgraph-data:/var/lib/memgraph
    environment:
      - MEMGRAPH_LOG_LEVEL=${MEMGRAPH_LOG_LEVEL:-WARNING}
    restart: unless-stopped

  lab:
    image: memgraph/lab
    container_name: codebase-intelligence-lab
    ports:
      - "${LAB_PORT:-3000}:3000"
    environment:
      QUICK_CONNECT_MG_HOST: memgraph
    depends_on:
      - memgraph
    restart: unless-stopped

volumes:
  memgraph-data:
    name: codebase-intelligence-memgraph-data
